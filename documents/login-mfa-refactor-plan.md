# Login / MFA Page Refactor Plan

`documents/pages-refactor-plan.md` ã®æ–¹é‡ã‚’è¸ã¾ãˆã€`frontend/src/pages/login.rs` ã¨ `frontend/src/pages/mfa/` ã‚’ä»¥ä¸‹ã®æ§‹é€ ã«å†ç·¨ã™ã‚‹ã€‚

## 1. ç›®æ¨™

- ãƒ­ã‚°ã‚¤ãƒ³ã¨ MFA å°‚ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å°å…¥ã—ã€ãƒ•ã‚©ãƒ¼ãƒ /UI ãƒ­ã‚¸ãƒƒã‚¯ã¨ API å‘¼ã³å‡ºã—ã‚’åˆ†é›¢ã™ã‚‹ã€‚
- èªè¨¼çŠ¶æ…‹ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚’å†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸åˆ‡ã‚Šå‡ºã™ã€‚
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ãƒˆãƒ¼ã‚¯ãƒ³å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆå¯èƒ½ãªç´”ç²‹é–¢æ•°ã«ç§»è¡Œã™ã‚‹ã€‚

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
frontend/src/pages/login/
    mod.rs          # ã‚¨ãƒ³ãƒˆãƒªï¼‹èªå¯ã‚¬ãƒ¼ãƒ‰
    panel.rs        # LoginPanel (ãƒ•ã‚©ãƒ¼ãƒ  + çŠ¶æ…‹åˆ¶å¾¡)
    components/
        form.rs     # ãƒ¦ãƒ¼ã‚¶ãƒ¼å/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ 
        messages.rs # æˆåŠŸãƒ»å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    repository.rs   # login/refresh/logout API ãƒ©ãƒƒãƒ‘ãƒ¼
    utils.rs        # å…¥åŠ›æ¤œè¨¼ãƒ»ãƒ‡ãƒã‚¤ã‚¹ãƒ©ãƒ™ãƒ«ç”Ÿæˆãªã©

frontend/src/pages/mfa/
    mod.rs
    panel.rs
    components/
        setup.rs
        verify.rs
    repository.rs   # MFA status/register/activate API
    utils.rs
```

## 3. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

1. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ** âœ… (Login) / âœ… (MFA)  
   - `mod.rs` ã‚’è¿½åŠ ã—ã€æ—¢å­˜ã® `login.rs` ã¨ `mfa.rs` ã‚’ `panel.rs` ã¸ç§»å‹•ã€‚
   - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‹ã‚‰ã¯ `pub use panel::LoginPage` ã®ã‚ˆã†ã«å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€‚

2. **ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åˆ†é›¢** âœ… (Login) / âœ… (MFA)  
   - ãƒ•ã‚©ãƒ¼ãƒ  UI (`input`, `button`) ã‚’ `components::form` ã«åˆ‡ã‚Šå‡ºã—ã€`panel` ã¯ `FormState` ã®èª­ã¿æ›¸ãã®ã¿æ‹…å½“ã€‚
   - æˆåŠŸ/å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’ `components::messages` ã¸é›†ç´„ã€‚

3. **çŠ¶æ…‹ç®¡ç†ãƒ»API ãƒ¬ã‚¤ãƒ¤** ğŸ”„  
   - `create_action` ã‚’åˆ©ç”¨ã—ã¦ `login`, `logout`, `refresh`, `mfa_register`, `mfa_activate` ã®å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã€‚
   - Login å´ã¯ `login/repository.rs` ã¨ `utils.rs` ã®å°å…¥å®Œäº†ã€‚MFA å´ã‚‚ `repository.rs` / `components` ã¸ã®åˆ†é›¢å®Œäº†ã—ã€`state::auth` ã‹ã‚‰åˆ©ç”¨ä¸­ã€‚

4. **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨ãƒ†ã‚¹ãƒˆ** ğŸ”„  
   - ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰/MFAã‚³ãƒ¼ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ `utils.rs` ã«ç§»å‹•æ¸ˆã¿ï¼ˆLogin/MFAï¼‰ã€‚ä»Šå¾Œ `#[cfg(test)]` ã®è¿½åŠ ãŒå¿…è¦ã€‚

5. **Guard/State é€£æº** ğŸ”„  
   - `state::auth` ã®ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸæ™‚æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’å†ç¢ºèªã—ã€`panel` ã§ `set_auth` ã‚’é©åˆ‡ã«å‘¼ã³å‡ºã™ã€‚
   - Login å´ã¯ `login_request` ã§ `set_auth` ã‚’å‘¼ã¶ã‚ˆã†æ•´ç†æ¸ˆã¿ã€‚MFA å´ã¯ã“ã‚Œã‹ã‚‰ã€‚

6. **ãƒ†ã‚¹ãƒˆ & ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** ğŸ”„  
   - `cargo fmt`, `cargo test -p timekeeper-frontend --lib` ã§å›å¸°ç¢ºèªã€‚
   - `documents/pages-refactor-plan.md` ã«è¨˜è¼‰ã—ãŸé€²æ—ã‚’æ›´æ–°ã€‚

## 4. æ³¨æ„ç‚¹

- ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã«ã‚ˆã‚‹ Warning æŠ‘åˆ¶ (`allow(dead_code)` ãªã©) ã¯ç¦æ­¢ã€‚æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ã¯å‰Šé™¤ã¾ãŸã¯åˆ©ç”¨ç®‡æ‰€ã‚’å®Ÿè£…ã™ã‚‹ã€‚
- ãƒ­ã‚°ã‚¤ãƒ³/MFA ãƒšãƒ¼ã‚¸ã‚‚ UTF-8 / LF ãƒ«ãƒ¼ãƒ«ã‚’éµå®ˆã™ã‚‹ã€‚
