# フロントエンド リファクタリング対象まとめ

## frontend/src/api/client.rs
- **問題点**
  - 1400行規模の巨大ファイルで、HTTPクライアントと localStorage 管理、JWT デコード、エラーハンドリングなど複数の責務が混在している。
  - 認証系処理（ログイン・リフレッシュ・ログアウト）でも同種のストレージ操作やレスポンス保存処理が重複しており、修正時の漏れや不整合が起きやすい。
  - 型安全な API レイヤーがなく、`serde_json::Value` に直接アクセスする箇所が多数あり、レスポンス仕様変更時の検知が困難。
- **改善案**
  - 認証専用のサービスモジュール（`auth_service.rs` など）を切り出し、`ApiClient` からは `trait` を通して利用する構造へ分割。
  - localStorage 利用や JWT デコードといった横断関心事を小さなヘルパー（`token_storage.rs` 等）に分け、重複コードを排除。
  - API ごとに専用の入力/出力型を定義して `serde_json::Value` の直接操作を減らす。

## frontend/src/state/auth.rs
- **問題点**
  - ログイン状態管理と API 呼び出しを同じ関数が担っており、UI ロジックと通信ロジックが密結合になっている。
  - localStorage 操作やトークン保存処理が `api/client.rs` と重複しており、同期漏れの原因になる。
  - エラー処理が `String` ベースのため、UI にとって扱いづらい。
- **改善案**
  - 状態操作は Signal 更新に限定し、API 呼び出しは `ApiClient` もしくは新設する `AuthService` に委譲。
  - エラー型を列挙型にして UI 側でパターンマッチしやすくする。

## frontend/src/components/forms.rs
- **問題点**
  - `LoginForm`、勤怠関連フォームなど多数の UI が 1 ファイル 400 行超に詰め込まれており、保守性が低い。
  - `LoginForm` 内で `spawn_local` を直接呼び出し、API クライアントを生成し…と、UI からアプリケーションロジックまでを包含している。
  - 共通化できる入力バリデーションやメッセージ表示ロジックが重複。
- **改善案**
  - フォーム種別ごとにコンポーネントファイルを分割し、共通スタイルや入力フィールドは小さなコンポーネントへ抽出。
  - 送信ハンドラは `state::auth` やサービス層の関数を呼ぶだけにし、UI は `Result` に応じて状態を更新するだけにする。
